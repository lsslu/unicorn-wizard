"use strict";angular.module("unicorn.wizard",[]),angular.module("unicorn.wizard").service("$ucWizard",function(){this.next=function(t,e){t.options.idx===e&&(t.options.completed=t.form.$valid,t.$emit("wizard:next"))},this.validate=function(t,e){t.$emit("wizard:finish",e)}}).directive("ucWizard",["$compile",function(t){return{restrict:"E",transclude:!0,replace:!0,scope:{onFinish:"=",onCancel:"="},templateUrl:"wizard.tpl.html",controller:["$scope",function(t){function e(){angular.forEach(t.steps,function(t){t.actived=!1})}t.steps=this.steps=[],t.currentStepIdx=0,t.validCount=0,t.validatedCount=0,t.buttons={prev:!1,next:!0,finish:!1,cancel:"function"==typeof t.onCancel},this.addStep=function(e){e.idx=t.steps.length,0===t.steps.length&&(e.actived=!0),t.steps.push(e)},t.goTo=function(n){if(!n)throw'"step" is undefined.                     Perhaps the currentStepIdx is out of range.                     May be you should check the "idx" of steps.';e(),n.actived=!0,t.currentStepIdx=n.idx,t.buttons.prev=t.currentStepIdx>0,t.buttons.next=t.currentStepIdx<t.steps.length-1,t.buttons.finish=t.currentStepIdx==t.steps.length-1},t.next=function(){t.$broadcast("wizard-step:canleave",t.currentStepIdx)},t.prev=function(){t.goTo(t.steps[--t.currentStepIdx])},t.finish=function(){t.validCount=0,t.validatedCount=0,t.$broadcast("wizard-step:validate")},t.cancel=function(){"function"==typeof t.onCancel&&t.onCancel()},t.$on("wizard:next",function(e,n){t.goTo(t.steps[++t.currentStepIdx])}),t.$on("wizard:finish",function(e,n){if(t.validatedCount+=1,t.steps[n.idx].completed=n.valid,n.valid&&(t.validCount+=1),!(t.validatedCount<t.steps.length))if(t.validCount<t.steps.length){for(var o=0;o<t.steps.length;o++)if(!t.steps[o].completed){t.goTo(t.steps[o]);break}}else"function"==typeof t.onFinish&&t.onFinish()})}],link:function(t,e,n){e.find(".content").height(n.height),t.stepWidth=(100/t.steps.length).toFixed(2)+"%"}}}]).directive("ucWzStep",function(){return{restrict:"E",scope:!0,replace:!0,transclude:!0,require:"^ucWizard",template:'<div ng-transclude class="uc-wz-step" ng-show="options.actived"></div>',controller:["$scope","$ucWizard",function(t,e){t.$on("uc:formLocator",function(e){if(t._formCtrlScope=e.targetScope,t._element){var n=t._element.find("ng-form,form").attr("name");n&&t._formCtrlScope&&(t.form=t._formCtrlScope[n],delete t._formCtrlScope,delete t._element)}}),t.$on("wizard-step:canleave",function(n,o){return t.form?t.form.$invalid?void(t.options.completed=!1):void e.next(t,o):void 0}),t.$on("wizard-step:validate",function(n){e.validate(t,{idx:t.options.idx,valid:t.form?t.form.$valid:!0})})}],link:function(t,e,n,o){t.options={title:e.attr("title"),actived:!1,completed:!1};var i=e.find("ng-form,form").attr("name");i&&t._formCtrlScope?(t.form=t._formCtrlScope[i],delete t._formCtrlScope):t._element=e,o.addStep(t.options)}}});
angular.module("unicorn.wizard").run(["$templateCache",function(n){n.put("wizard.tpl.html",'<div class="uc-wizard">\n    <div class="uc-wz-step-bar">\n        <ul>\n            <li ng-repeat="step in steps"\n                ng-class="{\'active\': step.actived, \'complete\': !step.actived && step.completed}"\n                style="width: {{::stepWidth}}">\n                <a ng-click="goTo(step)">\n                    <div class="step" ng-class="{\'ok\': step.completed}">\n                        <i class="glyphicon glyphicon-ok" ng-show="step.completed"></i>\n                        <span ng-hide="step.completed">{{::$index+1}}</span>\n                    </div>\n                    <span class="title">{{::step.title}}</span>\n                </a>\n            </li>\n        </ul>\n    </div>\n\n    <div class="content" ng-transclude>\n\n    </div>\n\n    <div class="button-bar">\n        <ul>\n            <li>\n                <button ng-click="prev()" ng-show="buttons.prev" class="btn btn-sm btn-default">prev</button>\n            </li>\n            <li>\n                <button ng-click="next()" ng-show="buttons.next" class="btn btn-sm  btn-primary">next</button>\n                <button ng-click="finish()" ng-show="buttons.finish" class="btn btn-sm btn-success">finish</button>\n                <button ng-click="cancel()" ng-show="buttons.cancel" class="btn btn-sm btn-default">cancel</button>\n            </li>\n        </ul>\n\n\n\n    </div>\n</div>\n')}]);